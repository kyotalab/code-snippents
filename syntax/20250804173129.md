---
id: 20250804173129
title: Valueを使ったYAMLのデシリアライズ処理のミニマム実装
type: syntax
tags: [rust, yaml, serde, dynamic-parsing, deserialize]
created: 2025-08-04 17:31:29
updated: 2025-08-05 14:41:45
---

## Valueを使ったYAMLのデシリアライズ処理のミニマム実装

### Code Snippet

```yaml
- date: "2024-01-15"
  product: "Laptop"
  category: "Electronics"
  amount: 1200
  quantity: 1
  region: "North"
  salesperson: "Alice"

- date: "2024-01-15"
  product: "Mouse"
  category: "Electronics"
  amount: 25
  quantity: 3
  region: "South"
  salesperson: "Bob"
```

```rust
use std::fs;
use serde_yaml::Value;

fn main() -> Result<(), Box<dyn std::error::Error>> {
    let path = "sales.yaml";
    let yaml = fs::read_to_string(path)?;
    let sales: Vec<Value> = serde_yaml::from_str(&yaml)?;

    println!("Loaded {} sales records:", sales.len());
    for (index, sale) in sales.iter().enumerate() {
        println!("Record {}: {:#?}", index + 1, sale);

        // YAML Valueの特定フィールドアクセス例
        if let Some(product) = sale.get("product") {
            println!("  Product: {}", product.as_str().unwrap_or("unknown"));
        }
    }

    Ok(())
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_yaml_value_access() {
        let yaml = r#"
- product: "Laptop"
  amount: 1200
- product: "Mouse"
  amount: 25
"#;

        let sales: Vec<Value> = serde_yaml::from_str(yaml).unwrap();
        assert_eq!(sales.len(), 2);
        assert_eq!(sales[0]["product"].as_str().unwrap(), "Laptop");
        assert_eq!(sales[0]["amount"].as_u64().unwrap(), 1200);
    }
}
```

**Output**

```bash
Loaded 2 sales records:
Record 1: Mapping {
    "date": String("2024-01-15"),
    "product": String("Laptop"),
    "category": String("Electronics"),
    "amount": Number(1200),
    "quantity": Number(1),
    "region": String("North"),
    "salesperson": String("Alice"),
}
  Product: Laptop
Record 2: Mapping {
    "date": String("2024-01-15"),
    "product": String("Mouse"),
    "category": String("Electronics"),
    "amount": Number(25),
    "quantity": Number(3),
    "region": String("South"),
    "salesperson": String("Bob"),
}
  Product: Mouse
```

---

### Point

1. 型安全性: YAML専用のValue型を使用
2. 実用的なアクセス例: フィールドへの動的アクセス方法を示す
3. テスト付き: 動作確認可能
4. 依存関係最適化: 必要最小限のクレートのみ

---

### Dependencies

```toml
serde_yaml = "0.9.34"
```

---

### Related Notes

- [RustでYAMLファイルのデシリアライズ処理のミニマム実装](./20250804171533.md) - YAML用の構造体を定義
