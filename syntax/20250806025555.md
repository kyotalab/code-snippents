---
id: 20250806025555
title: Valueを使ったJSONのデシリアライズ処理のミニマム実装
type: syntax
tags: [rust, json, serde, dynamic-parsing, deserialize]
created: 2025-08-06 02:55:55
updated: 2025-08-06 03:12:55
---

## Valueを使ったJSONのデシリアライズ処理のミニマム実装

### Code Snippet

```json
[
  {
    "date": "2024-01-15",
    "product": "Laptop",
    "category": "Electronics",
    "amount": 1200,
    "quantity": 1,
    "region": "North",
    "salesperson": "Alice"
  },
  {
    "date": "2024-01-15",
    "product": "Mouse",
    "category": "Electronics",
    "amount": 25,
    "quantity": 3,
    "region": "South",
    "salesperson": "Bob"
  }
]
```

```rust
use std::fs;
use serde_json::Value;

fn main() -> Result<(), Box<dyn std::error::Error>> {
    let path = "sales.json";
    let json = fs::read_to_string(path)?;
    let sales: Vec<Value> = serde_json::from_str(&json)?;

    println!("Loaded {} sales records:", sales.len());
    for (index, sale) in sales.iter().enumerate() {
        println!("Record {}: {:#?}", index + 1, sale);

        // JSON Valueの特定フィールドアクセス例
        if let Some(product) = sale.get("product") {
            println!("  Product: {}", product.as_str().unwrap_or("unknown"));
        }
    }

    Ok(())
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_json_value_access() {
        let json = r#"
[
  {
    "date": "2024-01-15",
    "product": "Laptop",
    "category": "Electronics",
    "amount": 1200,
    "quantity": 1,
    "region": "North",
    "salesperson": "Alice"
  },
  {
    "date": "2024-01-15",
    "product": "Mouse",
    "category": "Electronics",
    "amount": 25,
    "quantity": 3,
    "region": "South",
    "salesperson": "Bob"
  }
]
"#;

        let sales: Vec<Value> = serde_json::from_str(json).unwrap();
        assert_eq!(sales.len(), 2);
        assert_eq!(sales[0]["product"].as_str().unwrap(), "Laptop");
        assert_eq!(sales[0]["amount"].as_u64().unwrap(), 1200);
    }
}
```

**Output**

```bash
Loaded 4 sales records:
Record 1: Object {
    "amount": Number(1200),
    "category": String("Electronics"),
    "date": String("2024-01-15"),
    "product": String("Laptop"),
    "quantity": Number(1),
    "region": String("North"),
    "salesperson": String("Alice"),
}
  Product: Laptop
Record 2: Object {
    "amount": Number(25),
    "category": String("Electronics"),
    "date": String("2024-01-15"),
    "product": String("Mouse"),
    "quantity": Number(3),
    "region": String("South"),
    "salesperson": String("Bob"),
}
  Product: Mouse
Record 3: Object {
    "amount": Number(300),
    "category": String("Furniture"),
    "date": String("2024-01-16"),
    "product": String("Desk"),
    "quantity": Number(2),
    "region": String("North"),
    "salesperson": String("Alice"),
}
  Product: Desk
Record 4: Object {
    "amount": Number(150),
    "category": String("Furniture"),
    "date": String("2024-01-16"),
    "product": String("Chair"),
    "quantity": Number(4),
    "region": String("South"),
    "salesperson": String("Carol"),
}
  Product: Chair
```

---

### Point

1. 型安全性: JSON専用のValue型を使用
2. 実用的なアクセス例: フィールドへの動的アクセス方法を示す
3. テスト付き: 動作確認可能
4. 依存関係最適化: 必要最小限のクレートのみ

---

### Dependencies

2025-08-06（現在）

```toml
serde_json = "1.0.142"
```

---

### Related Notes

- [RustでJSONファイルのデシリアライズ処理のミニマム実装](./20250804163538.md) - JSON用の構造体を使用
- [Valueを使ったYAMLのデシリアライズ処理のミニマム実装](./20250804173129.md) - `serde_yaml::Value` を使用
