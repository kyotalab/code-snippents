---
id: 20250804015048
title: エラーファーストドメイン設計におけるドメインモデリング
type: concept
tags: [error-first]
created: 2025-08-04 01:50:48
updated: 2025-08-04 02:25:56
---

## エラーファーストドメイン設計におけるドメインモデリング

### ドメイン分析: ビジネスルールからエラーを導出

1. **不変条件の特定**
   - 「このオブジェクトが絶対に守るべきルールは？」
   - 「どんな状況でも破ってはいけない制約は？」
   - 「ビジネス上許されない状態とは？」
2. **前提条件の特定**
   - 「この操作を実行するために必要な条件は？」
   - 「どんな状態の時にこの操作は許可される？」
   - 「事前チェックすべき項目は？」
3. **事後条件の特定**
   - 「この操作が成功したら何が保証される？」
   - 「完了後にどんな状態になっているべき？」
   - 「副作用として何が起こるべき？」

---

### アーキテクチャ設計: 層間でのエラー変換ルールを策定

1. **下位層のエラーを上位層の関心事に変換**
   - SQLExceptionを在庫不足エラーに変換
   - HTTP 404をリソース未発見エラーに変換
2. **エラーコンテキストの保持**
   - 原因チェーンの維持
   - デバッグ情報とユーザ向け情報の分離
3. **回復戦略の組み込み**
   - リトライ可能/不可能の区別
   - 代替処理への誘導

---

### 実装検証: テスタビリティを考慮したエラー設計

1. **エラー注入の仕組み**
   - テスト用のエラー発生器
   - カオスエンジニアリング的アプローチ
2. **エラー境界の明確化**
   - 各コンポーネントの席範囲を型で表現
   - エラーハンドラーの配置戦略

---

### 運用改善: 実データからエラーパターンを学習し設計を改善

1. 運用面での発見事例の共有
   - よくある不変条件違反
   - よくある前提条件未充足
   - よくある事後条件不成立

> [!NOTE] > **各条件の違反は異なる種類のエラーとして扱い、適切な回復戦略を用意する**
