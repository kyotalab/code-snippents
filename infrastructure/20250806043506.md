---
id: 20250806043506
title: Go aws-sdk-go-v2を使ったdescribe_security_groups
type: infrastructure
tags: [go, aws-sdk-go-v2, describe_security_groups]
created: 2025-08-06 04:35:06
updated: 2025-08-06 04:35:06
---

## Go aws-sdk-go-v2を使ったdescribe_security_groups

### Code Snippet

```go
package main

import (
	"context"
	"fmt"
	"log"

	"github.com/aws/aws-sdk-go-v2/config"
	"github.com/aws/aws-sdk-go-v2/service/ec2"
	"github.com/aws/aws-sdk-go-v2/service/ec2/types"
)

func main() {
	cfg, err := config.LoadDefaultConfig(context.TODO())
	if err != nil {
		log.Fatalf("unable to load SDK config, %v", err)
	}

	client := ec2.NewFromConfig(cfg)
	if err := describeSecurityGroups(client); err != nil {
		log.Fatalf("failed to describe security groups: %v", err)
	}
}

func describeSecurityGroups(client *ec2.Client) error {
	output, err := client.DescribeSecurityGroups(context.TODO(), &ec2.DescribeSecurityGroupsInput{})
	if err != nil {
		return fmt.Errorf("API call failed: %w", err)
	}

	for _, group := range output.SecurityGroups {
		printSecurityGroup(group)
	}
	return nil
}

func printSecurityGroup(group types.SecurityGroup) {
	groupName := getStringValue(group.GroupName)
	groupId := getStringValue(group.GroupId)
	vpdId := getStringValue(group.VpcId)
	description := getStringValue(group.Description)

	fmt.Printf("Found Security Groups %s (%s), vpc id %s and description %s\n",
		groupName, groupId, vpdId, description)
}

func getStringValue(s *string) string {
	if s == nil {
		return "unknown"
	}

	return *s
}
```

---

### Points

- 関数分離: `main` 関数から実際のAPI処理を分離し、単一責任の原則を適用
- エラー伝播: `fmt.Errorf` と `%w` 動詞を使用してエラーチェーンを維持
- Nil安全性: ヘルパー関数 `getStringValue()` でポインタの安全なデリファレンスを実装
- 適切なエラーハンドリング: API呼び出しとアプリケーション終了を分離
- 型の明示: `types.SecurityGroup` を引数に取ることで型安全性を確保
- デフォルト値: nil値に対して"unknown"という意味のあるデフォルト値を設定
- 一貫性のあるログ出力: エラーメッセージの形式を統一
- テスタビリティ: 関数を分離することで単体テストが容易になる構造
- 可読性: 長いprint文を専用関数に分離して見通しを改善

---

### 実行速度

```bash
# コンパイル込み
$ time go run main.go
Found Security Groups default (sg-056e444c1891b25f7), vpc id vpc-0c896a4cf4a0ea47e and description default VPC security group
Found Security Groups launch-wizard-1 (sg-0aa114dbcfa7f4094), vpc id vpc-0c896a4cf4a0ea47e and description launch-wizard-1 created 2025-06-23T19:28:45.143Z
Found Security Groups launch-wizard-2 (sg-09e4b82ddc89e99a7), vpc id vpc-0c896a4cf4a0ea47e and description launch-wizard-2 created 2025-06-23T19:39:03.390Z
go run main.go  0.79s user 0.79s system 53% cpu 2.934 total

# 事前コンパイル
$ time ./main
Found Security Groups default (sg-056e444c1891b25f7), vpc id vpc-0c896a4cf4a0ea47e and description default VPC security group
Found Security Groups launch-wizard-1 (sg-0aa114dbcfa7f4094), vpc id vpc-0c896a4cf4a0ea47e and description launch-wizard-1 created 2025-06-23T19:28:45.143Z
Found Security Groups launch-wizard-2 (sg-09e4b82ddc89e99a7), vpc id vpc-0c896a4cf4a0ea47e and description launch-wizard-2 created 2025-06-23T19:39:03.390Z
./main  0.01s user 0.01s system 4% cpu 0.653 total
```
