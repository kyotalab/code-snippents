---
id: 20250813144913
title: Rust vs Go Enum型バリデーション実装比較
type: technique
tags: [rust, go, enum, validation]
created: 2025-08-13 14:49:13
updated: 2025-08-13 21:21:11
---

## Rust vs Go: Enum型バリデーション実装比較

### 概要

RustのEnum型とFromStrトレイトを使ったバリデーション実装と、Goでの同等機能実装パターンの比較分析。
AWSクラウドエンジニア・OSS開発者向けの実用的な設計指針。

---

### 🦀 Rust実装

#### 基本実装

```rust
#[derive(Debug, Clone)]
pub enum OutputFormat {
    Auto,
    Json,
    Table,
    List,
    Csv,
}

impl std::str::FromStr for OutputFormat {
    type Err = Error;

    fn from_str(s: &str) -> Result<Self, Self::Err> {
        match s.to_lowercase().as_str() {
            "auto" => Ok(OutputFormat::Auto),
            "json" => Ok(OutputFormat::Json),
            "table" => Ok(OutputFormat::Table),
            "list" => Ok(OutputFormat::List),
            "csv" => Ok(OutputFormat::Csv),
            _ => Err(Error::InvalidFormat(format!(
                "Invalid format: {}. Valid options: auto, json, table, list, csv",
                s
            ))),
        }
    }
}
```

#### 特徴

- **型安全性**: コンパイル時に全ケースを強制
- **標準トレイト**: `FromStr`によるエコシステム親和性
- **メモリ効率**: enum値は軽量（discriminant + data）
- **パターンマッチング**: 網羅性チェック

---

### 🐹 Go実装パターン

#### Pattern 1: Switch文パターン（推奨）

```go
type OutputFormat string

const (
    OutputAuto  OutputFormat = "auto"
    OutputJson  OutputFormat = "json"
    OutputTable OutputFormat = "table"
    OutputList  OutputFormat = "list"
    OutputCsv   OutputFormat = "csv"
)

// より意図が明確な命名
func ParseOutputFormat(s string) (OutputFormat, error) {
    format := OutputFormat(strings.ToLower(s))
    if !format.IsValid() {
        return "", fmt.Errorf("invalid format: %s. valid options: auto, json, table, list, csv", s)
    }
    return format, nil
}

// または FromStr により近い命名
func OutputFormatFromString(s string) (OutputFormat, error) {
    format := OutputFormat(strings.ToLower(s))
    if !format.IsValid() {
        return "", fmt.Errorf("invalid format: %s. valid options: auto, json, table, list, csv", s)
    }
    return format, nil
}

func (o OutputFormat) IsValid() bool {
    switch o {
    case OutputAuto, OutputJson, OutputTable, OutputList, OutputCsv:
        return true
    default:
        return false
    }
}

func ValidOutputFormats() []OutputFormat {
    return []OutputFormat{OutputAuto, OutputJson, OutputTable, OutputList, OutputCsv}
}
```

#### Pattern 2: Map Lookupパターン（非推奨）

```go
type OutputFormat string

var AllowedFormat = map[OutputFormat]bool{
    "auto":  true,
    "json":  true,
    "table": true,
    "list":  true,
    "csv":   true,
}

func IsOutputFormat(format string) (OutputFormat, error) {
    outputFormat := OutputFormat(strings.ToLower(format))
    if !AllowedFormat[outputFormat] {
        return "", fmt.Errorf("invalid format: %s", format)
    }
    return outputFormat, nil
}
```

---

### ⚖️ 専門家レビュー結果

#### 🚀 パフォーマンス比較

| 実装                    | メモリ割り当て               | 実行速度             | 最適化     |
| ----------------------- | ---------------------------- | -------------------- | ---------- |
| **Rust enum + FromStr** | `to_lowercase()`でString生成 | 高速（match最適化）  | ⭐⭐⭐⭐⭐ |
| **Go Switch文**         | `ToLower()`でstring生成      | 高速（switch最適化） | ⭐⭐⭐⭐   |
| **Go Map Lookup**       | string生成 + ハッシュ計算    | 中速（map overhead） | ⭐⭐⭐     |

**Winner**: Rust > Go Switch > Go Map

#### 🛡️ 安全性・エラーハンドリング

| 項目                     | Rust       | Go Switch | Go Map |
| ------------------------ | ---------- | --------- | ------ |
| **コンパイル時チェック** | ⭐⭐⭐⭐⭐ | ⭐⭐      | ⭐⭐   |
| **実行時安全性**         | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐  | ⭐⭐⭐ |
| **エラー詳細度**         | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐  | ⭐⭐⭐ |
| **グローバル状態依存**   | なし       | なし      | あり   |

**Winner**: Rust > Go Switch > Go Map

#### 🏗️ アーキテクチャ・保守性

| 項目                   | Rust       | Go Switch  | Go Map   |
| ---------------------- | ---------- | ---------- | -------- |
| **可読性**             | ⭐⭐⭐⭐   | ⭐⭐⭐⭐⭐ | ⭐⭐⭐   |
| **拡張性**             | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐   | ⭐⭐⭐⭐ |
| **テスト容易性**       | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐   |
| **言語イディオム準拠** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐     |

**Winner**: Rust ≈ Go Switch > Go Map

---

### 🎯 推奨実装戦略

#### Rustでの実装

- **基本**: `enum` + `FromStr`トレイト
- **拡張**: `Display`、`Serialize`/`Deserialize`も実装
- **エラー**: カスタムエラー型でコンテキスト情報を豊富に

#### Goでの実装

- **基本**: String-based constants + Switch文
- **拡張**: レシーバーメソッドでの検証・変換機能
- **エラー**: 標準`error`インターフェースで十分

---

### 🔄 対応関係マップ

| Rust概念                    | Go相当                      | 備考                       |
| --------------------------- | --------------------------- | -------------------------- |
| `enum`                      | `type T string` + constants | Goは代数的データ型なし     |
| `FromStr` trait             | Constructor function        | `NewXxx()` パターン        |
| `Result<T, E>`              | `(T, error)`                | Goの標準エラーハンドリング |
| `match` expression          | `switch` statement          | Goは式ではなく文           |
| Compile-time exhaustiveness | Runtime validation          | Goは実行時チェック         |

---

### 💼 実用例：AWS CLI風ツール

#### Rust実装例

```rust
// 使用例
let format: OutputFormat = "json".parse()?;
println!("Using format: {:?}", format);

// AWS SDK連携
match format {
    OutputFormat::Json => serde_json::to_string(&response)?,
    OutputFormat::Table => format_as_table(&response),
    // ...
}
```

#### Go実装例

```go
// 使用例
format, err := NewOutputFormat("json")
if err != nil {
    return err
}
fmt.Printf("Using format: %s\n", format)

// AWS SDK連携
switch format {
case OutputJson:
    return json.Marshal(response)
case OutputTable:
    return formatAsTable(response)
// ...
}
```

---

### 📚 学習ポイント

#### Rustで習得すべき概念

1. **Ownership & Borrowing**: `&str` vs `String`の使い分け
2. **Trait System**: 標準トレイトの活用法
3. **Error Handling**: `Result<T, E>`の慣用的使用
4. **Pattern Matching**: 網羅性とガード句

#### Goで習得すべき概念

1. **Type Definitions**: `type` による新しい型定義
2. **Method Sets**: レシーバーメソッドの設計
3. **Interface Satisfaction**: 暗黙的インターフェース実装
4. **Error Conventions**: エラー値の慣用的処理

---

### 🛠️ 開発環境での活用

#### Rust開発

```toml
# Cargo.toml
[dependencies]
serde = { version = "1.0", features = ["derive"] }
clap = { version = "4.0", features = ["derive"] }
```

#### Go開発

```go
// go.mod
module myproject

go 1.21

require (
    github.com/spf13/cobra v1.7.0
)
```

---

### 🎯 まとめ

#### 言語選択指針

**Rustを選ぶべき場合:**

- 最高のパフォーマンスが必要
- 型安全性が重要（金融・医療系）
- 長期保守性を重視
- システムプログラミング要件

**Goを選ぶべき場合:**

- 開発速度を重視
- チーム開発での可読性が重要
- クラウドネイティブアプリケーション
- マイクロサービス・API開発

#### 🏆 総合評価

**Rust**: 🥇 パフォーマンス・安全性で圧倒的
**Go Switch**: 🥈 実用性・開発効率のバランス良好  
**Go Map**: 🥉 特定用途でのみ有効
